<!doctype html><html lang=en class="wf-firasans-n4-active wf-active"><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.121.0"><title>C# Garbage Collector - Part 1 &#183; Moien Tajik</title>
<meta content="Moien Tajik" property="og:site_name"><meta content="C# Garbage Collector - Part 1 - Moien Tajik" property="og:title"><meta content="In this series of articles, we aim to dive into Memory Management in C#, acquaint ourselves with the Garbage Collector, and gain an overall understanding of how it operates." property="og:description"><meta content="./GC.jpg" property="og:image"><link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel=stylesheet><style media=print>.sidebar{display:none!important}.container,.content{width:100%;float:none;display:initial;margin:0 auto}.container{padding-left:1rem;padding-right:1rem}</style><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/hyde.css><link rel=stylesheet href=/css/custom.css><script defer src=https://use.fontawesome.com/releases/v5.0.13/js/all.js integrity=sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-te><div class=sidebar><div class="container text-center"><div class="sidebar-about text-center"><img src=/img/Moien%20Tajik.png alt="Moien Tajik's Image" class="img-circle headshot center">
<a href=/ class=no-decoration><h1 class=brand>Moien Tajik</h1></a><p class=lead>Principal Software Engineer</p></div><div><ul class=sidebar-nav><li><a href=/><span>Home</span></a></li><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li></li></ul></div><p><section class="row text-center"><a href=https://twitter.com/MoienTajik><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://github.com/MoienTajik><i class="fab fa-github fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://linkedin.com/in/MoienTajik><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://stackoverflow.com/story/moientajik><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://medium.com/@MoienTajik><i class="fab fa-medium fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=mailto:moientajik@hotmail.com><i class="fas fa-at fa-lg" aria-hidden=true></i></a></section></p><p class=copyright>&copy; 2024 Moien Tajik</br><a href=https://creativecommons.org/licenses/by/4.0>All rights reserved</a></p></div><div></div></div><div class="content container"><div class=post><h1 class=postTitle>C# Garbage Collector - Part 1</h1><div class="col-sm-12 col-md-12"><span class="text-left post-date meta"><i class="fas fa-calendar-alt"></i> <span class=subtitle>Publish Date: Nov 29, 2019</span><br><i class="fas fa-tags"></i>
Tags:
<a class=meta href=/tags/c>c#</a>
,
<a class=meta href=/tags/csharp>csharp</a>
,
<a class=meta href=/tags/garbage-collector>garbage collector</a>
,
<a class=meta href=/tags/gc>gc</a><br></span></div><hr><br><p><img src=./GC.jpg alt="Garbage Collection"></p><div style=text-align:center><span style=font-weight:700;text-align:center>Garbage Collection</span></div><br><p>Imagine you have created a variable and assigned it a value:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>string</span> message = <span style=color:#e6db74>&#34;Hello World!&#34;</span>;
</span></span></code></pre></div><p>Have you ever wondered about the lifespan of the message variable? When should it be removed from memory by the runtime?</p><hr><p>Programming languages are divided into two categories: Managed and Unmanaged:</p><ol><li><p><strong>Unmanaged:</strong> In these languages, the responsibility of object creation, determining the right time for their disposal, and their actual disposal rests on you. C and C++ are examples of unmanaged languages.</p></li><li><p><strong>Managed:</strong> In these languages, you are still responsible for object creation, but the runtime takes over the responsibility of deciding and disposing of them at the right time. In such languages, we don&rsquo;t worry about deleting a variable we created several lines above, passed to several methods, and manipulated in various ways. C# and Java are examples of managed languages.</p></li></ol><p>The key idea behind managed languages is to free you from the complexities of memory management, allowing you to focus on the business logic.</p><p>Most projects have enough business complexities. Combining these with the technical complexities of memory management often makes maintaining the project extremely difficult, gradually turning many into legacy systems.</p><p>This doesn&rsquo;t mean projects written in languages like C and C++ are inherently legacy or unmaintainable. It implies that maintaining code in such languages is generally harder. Moreover, a project&rsquo;s maintainability depends on many other factors.</p><img src=./Legacy.jpeg height=300px alt="Legacy Code" style=margin:auto><br><p>Let&rsquo;s compare a simple example in both C and C#.</p><p>We have a program that creates an integer variable, assigns the value 25 to it, and then passes this variable to a method for printing.</p><p>C code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdlib.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>printReport</span>(<span style=color:#66d9ef>int</span><span style=color:#f92672>*</span> data)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;Report: %d&#34;</span>, <span style=color:#f92672>*</span>data);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>void</span>)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>myNumber;
</span></span><span style=display:flex><span>    myNumber <span style=color:#f92672>=</span> (<span style=color:#66d9ef>int</span><span style=color:#f92672>*</span>)<span style=color:#a6e22e>malloc</span>(<span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>int</span>));
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (myNumber <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;ERROR: Out of memory&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>*</span>myNumber <span style=color:#f92672>=</span> <span style=color:#ae81ff>25</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printReport</span>(myNumber);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>free</span>(myNumber);
</span></span><span style=display:flex><span>    myNumber <span style=color:#f92672>=</span> NULL;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>The &ldquo;goal&rdquo; and primary business of this program was to print a simple report, but more issues were involved:</p><ol><li>Allocating memory for an integer using <code>malloc</code>.</li><li>Casting the returned void pointer to an int pointer.</li><li>Maintaining the address of the allocated variable in a pointer.</li><li>Checking if memory allocation was successful.</li><li>Assigning the value 25 to the allocated variable.</li><li>Passing the <code>myNumber</code> pointer to the <code>printReport</code> function.</li><li>Freeing the allocated memory for myNumber when no longer needed.</li><li>Setting myNumber to NULL to prevent <a href=https://en.wikipedia.org/wiki/Dangling_pointer>dangling pointer</a> issues.</li></ol><p>How many of these steps were truly necessary for our program&rsquo;s business logic? This is a very simple and unrealistic example, but imagine the code volume and complexity for a large program with its own business rules and complexities.</p><p>C# code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> System;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Program</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> Main()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>int</span> myNumber = <span style=color:#ae81ff>25</span>;
</span></span><span style=display:flex><span>        PrintReport(myNumber);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> PrintReport(<span style=color:#66d9ef>int</span> number)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        Console.WriteLine(<span style=color:#e6db74>$&#34;Report: {number}&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As you can see, our focus here is on the main goal and business logic, without the complexities of manual memory management. The C# runtime, <a href=https://github.com/dotnet/coreclr>CoreCLR</a>, handles memory management behind the scenes.</p><hr><img src=./Transmission.png height=300px alt=Transmission style=margin:auto><br><p>The difference between Managed and Unmanaged languages can be likened to driving a manual vs. an automatic car.</p><p>Usually, the main goal of driving is to go from point <strong>A</strong> to point <strong>B</strong>. With a manual car, in addition to reaching our destination, we are engaged in changing gears at the <strong>right</strong> speed, potentially hundreds or thousands of times. In this method, we have more control and sometimes perform better compared to an automatic system, but we deviate from our primary goal.</p><p>On the other hand, with an automatic car, all our focus is on reaching our destination. We are not involved in changing gears multiple times along the way, as an external engine handles this task. Although this method is easier than the manual approach, you naturally have less control than before.<br></p><h3 id=similar-differences-exist-between-managed-and-unmanaged-languages>Similar differences exist between Managed and Unmanaged languages.</h3><br><p>In <strong>Unmanaged</strong> languages, you have full control over the lifespan of objects and memory management, but you are also involved in other side topics. The power of unmanaged languages is often seen in game engines and real-time processing systems, where memory management is done manually, and the developers determine the lifespan of objects to avoid any disruptions or slowdowns, even for a few milliseconds.</p><p>In <strong>Managed languages</strong>, most of the time, you don&rsquo;t even need to get involved in the side topics of memory management, as your runtime automatically handles it. However, sometimes you need to identify sensitive parts of your program (so-called Hot-Paths), benchmark them, and ensure they perform well under high load and request volumes, and also that they don&rsquo;t have memory leaks. Sometimes a human (manual system) can decide better than an automatic system about what should happen in a program at a given moment.</p><p>In this series of articles, we aim to delve into Memory Management in C#, acquaint ourselves with the Garbage Collector, and gain an overall understanding of how it operates.</p></div><hr><div class=footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script type=text/javascript>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><h2>Comments</h2><div id=disqus_thread></div><script type=text/javascript>(function(){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="moientajik",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></body></html>