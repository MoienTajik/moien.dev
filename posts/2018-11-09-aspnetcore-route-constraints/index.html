<!doctype html><html lang=en class="wf-firasans-n4-active wf-active"><head><link href=http://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=generator content="Hugo 0.121.0"><title>Route constraints in ASP.NET Core &#183; Moien Tajik</title>
<meta content="Moien Tajik" property="og:site_name"><meta content="Route constraints in ASP.NET Core - Moien Tajik" property="og:title"><meta content="In ASP.NET Core, Route constraints prevent invalid values from reaching the parameters of a controller's action." property="og:description"><meta content="/img/posts/2018-11-09-AspNetCore-Route-Constraints/routing.png" property="og:image"><link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel=stylesheet><style media=print>.sidebar{display:none!important}.container,.content{width:100%;float:none;display:initial;margin:0 auto}.container{padding-left:1rem;padding-right:1rem}</style><link rel=stylesheet href=/css/poole.css><link rel=stylesheet href=/css/hyde.css><link rel=stylesheet href=/css/custom.css><script defer src=https://use.fontawesome.com/releases/v5.0.13/js/all.js integrity=sha384-xymdQtn1n3lH2wcu0qhcdaOpQwyoarkgLVxC/wZ5q7h9gHtxICrpcaSUfygqZGOe crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-dark.min.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body class=theme-base-te><div class=sidebar><div class="container text-center"><div class="sidebar-about text-center"><img src=/img/Moien%20Tajik.png alt="Moien Tajik's Image" class="img-circle headshot center">
<a href=/ class=no-decoration><h1 class=brand>Moien Tajik</h1></a><p class=lead>Principal Software Engineer</p></div><div><ul class=sidebar-nav><li><a href=/><span>Home</span></a></li><li><a href=/posts/><span>Posts</span></a></li><li><a href=/tags/><span>Tags</span></a></li></li></ul></div><p><section class="row text-center"><a href=https://twitter.com/MoienTajik><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://github.com/MoienTajik><i class="fab fa-github fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://linkedin.com/in/MoienTajik><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://stackoverflow.com/story/moientajik><i class="fab fa-stack-overflow fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=https://medium.com/@MoienTajik><i class="fab fa-medium fa-lg" aria-hidden=true></i></a>
&nbsp;<a href=mailto:moientajik@hotmail.com><i class="fas fa-at fa-lg" aria-hidden=true></i></a></section></p><p class=copyright>&copy; 2024 Moien Tajik</br><a href=https://creativecommons.org/licenses/by/4.0>All rights reserved</a></p></div><div></div></div><div class="content container"><div class=post><h1 class=postTitle>Route constraints in ASP.NET Core</h1><div class="col-sm-12 col-md-12"><span class="text-left post-date meta"><i class="fas fa-calendar-alt"></i> <span class=subtitle>Publish Date: Nov 9, 2018</span><br><i class="fas fa-tags"></i>
Tags:
<a class=meta href=/tags/aspnet>aspnet</a>
,
<a class=meta href=/tags/aspnetcore>aspnetcore</a>
,
<a class=meta href=/tags/routing>routing</a><br></span></div><hr><p>Route constraints in ASP.NET Core allow you to prevent invalid values from reaching the parameters of an action method within a controller.</p><p>For instance, you can impose a constraint such that routing only occurs when the parameter entered by the user is of type <code>int</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ValuesController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{id:int}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult Get(<span style=color:#66d9ef>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(id);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=custom-linebreak></div><p>By setting a breakpoint at the beginning of the action method, if you try to invoke this action with an alpha string, you&rsquo;ll notice that it doesn&rsquo;t hit the breakpoint, and routing doesn&rsquo;t occur. However, if called with a number, the routing successfully takes place and returns the input value, confirming that the constraint is functioning correctly.</p><p>✖ api/values/hi</p><p>✓ api/values/7</p><div class=custom-linebreak></div><p>You might wonder, how is this different from the following code?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ValuesController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{id}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult Get(<span style=color:#66d9ef>int</span> id)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// id is 0 here if you pass string.</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(id);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>In this scenario, if you pass an alpha string as a parameter, routing <strong>does occur</strong>. However, since the input isn&rsquo;t an <code>int</code>, the <code>id</code> will default to <strong>0</strong>.</p><p>✓ api/values/hi</p><p>✓ api/values/7</p><hr><p>There are two ways to apply Route Constraints to URL parameters:</p><h4 id=heading></h4><h3 id=1--inline-constraints>1- Inline constraints</h3><p>These constraints are placed immediately after the URL parameter and are separated using a colon:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>app.UseMvc(routes =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    routes.MapRoute(<span style=color:#e6db74>&#34;Values&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;api/values/{id:int}&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>new</span> { controller = <span style=color:#e6db74>&#34;Values&#34;</span>, action = <span style=color:#e6db74>&#34;Get&#34;</span> });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>Additionally, you can combine multiple constraints, and you aren&rsquo;t limited to just one:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ValuesController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{name:minlength(2):maxlength(10):alpha}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult Get(<span style=color:#66d9ef>string</span> name)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(name);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>✖ api/values/M</p><p>✖ api/values/1234</p><p>✖ api/values/abcdefghijk</p><p>✓ api/values/Moien</p><h3 id=2--maproutes-constraints>2- MapRoute&rsquo;s constraints</h3><p>All constraints are classes that implement the IRouteConstraint interface. Within <code>MapRoute</code>, you can directly use those classes as constraints:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>app.UseMvc(routes =&gt;
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    routes.MapRoute(
</span></span><span style=display:flex><span>        name: <span style=color:#e6db74>&#34;Values&#34;</span>,
</span></span><span style=display:flex><span>        template: <span style=color:#e6db74>&#34;api/values/{name}&#34;</span>,
</span></span><span style=display:flex><span>        defaults: <span style=color:#66d9ef>new</span> { controller = <span style=color:#e6db74>&#34;Values&#34;</span>, action = <span style=color:#e6db74>&#34;Get&#34;</span> },
</span></span><span style=display:flex><span>        constraints: <span style=color:#66d9ef>new</span>
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            name = <span style=color:#66d9ef>new</span> CompositeRouteConstraint(<span style=color:#66d9ef>new</span> List&lt;IRouteConstraint&gt;
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> AlphaRouteConstraint(),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> MinLengthRouteConstraint(<span style=color:#ae81ff>2</span>),
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>new</span> MaxLengthRouteConstraint(<span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>            })
</span></span><span style=display:flex><span>        });
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p><strong>*</strong> This way of using constraints is not possible in Attribute Routing.</p><hr><h3 id=creating-a-custom-constraint>Creating a custom constraint</h3><p>As mentioned before, all constraints are classes implementing the <code>IRouteConstraint</code> interface. Hence, we can create a custom constraint by implementing this interface.</p><p>For instance, we aim to develop a constraint that takes a string input, applies the <code>StartsWith</code> method on it, and executes routing if the result is <code>true</code>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StartsWithConstraint</span> : IRouteConstraint
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> StartsWithConstraint(<span style=color:#66d9ef>string</span> startsWith)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>string</span>.IsNullOrWhiteSpace(startsWith))
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ArgumentNullException(nameof(StartsWith));
</span></span><span style=display:flex><span>        StartsWith = startsWith;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>string</span> StartsWith { <span style=color:#66d9ef>get</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>bool</span> Match(HttpContext httpContext,
</span></span><span style=display:flex><span>        IRouter route,
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> parameterName,
</span></span><span style=display:flex><span>        RouteValueDictionary values,
</span></span><span style=display:flex><span>        RouteDirection routeDirection)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (parameterName == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ArgumentNullException(nameof(parameterName));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (values == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ArgumentNullException(nameof(values));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (!values.TryGetValue(parameterName, <span style=color:#66d9ef>out</span> <span style=color:#66d9ef>var</span> <span style=color:#66d9ef>value</span>) || <span style=color:#66d9ef>value</span> == <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>string</span> valueString = Convert.ToString(<span style=color:#66d9ef>value</span>, CultureInfo.InvariantCulture);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> valueString.StartsWith(StartsWith);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><div class=custom-linebreak></div>After creating your custom constraint, you need to register it in your DI container:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>services.Configure&lt;RouteOptions&gt;(opt =&gt;
</span></span><span style=display:flex><span>    opt.ConstraintMap.Add(<span style=color:#e6db74>&#34;startsWith&#34;</span>, <span style=color:#66d9ef>typeof</span>(StartsWithConstraint)));
</span></span></code></pre></div><p><div class=custom-linebreak></div>Finally, use the name you gave during registration (in this case, <code>startsWith</code>) as your routing constraint:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#a6e22e>[Route(&#34;api/[controller]</span><span style=color:#e6db74>&#34;)]
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ValuesController</span> : ControllerBase
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#a6e22e>    [HttpGet(&#34;{name:minlength(2):maxlength(10):alpha:startsWith(Mo)}&#34;)]</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> IActionResult Get(<span style=color:#66d9ef>string</span> name)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Ok(name);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>✖ api/values/John</p><p>✓ api/values/Moien</p><p>✓ api/values/Michael</p><hr><p><strong>*</strong> You can view the list of default constraints in ASP.NET Core <a href=https://gist.github.com/MoienTajik/5c5962dba7fb2de278c7eece944f3d85#aspnet-core-default-route-constraints-list>here</a>.</p></div><hr><div class=footer><script src=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script type=text/javascript>hljs.configure({languages:[]}),hljs.initHighlightingOnLoad()</script><h2>Comments</h2><div id=disqus_thread></div><script type=text/javascript>(function(){if(location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="moientajik",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></div></body></html>